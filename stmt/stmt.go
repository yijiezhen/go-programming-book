package main

import (
	"bufio"
	"os"
	"fmt"
	"math/rand"
	"strconv"
	"github.com/pkg/sftp"
	"golang.org/x/crypto/ssh"

)

func check(err error) {
	if err != nil {
		panic(err)
	}
}

var headerLine1 = "00100004300000000000000045BETA 20160502000000"
var headerLine2 = "00200004300100000000000359F43  0430012016040120160430201603302016042720160330201604272016040120160430                                0000000000000017830760000000000017425030000000000004805289000000000005007410000000000000018190000000000000022690000000000001143755200000000001131884900000000001130845000000000001135889300000000002065300000000000002043940000000"
var headerLine3 = "01000004300100000000000326THIS IS A FREE-FORM                                         STATEMENT AREA CONSISTING OF                                5 LINES OF 60 CHARACTERS                                    TO BE USED AS THE                                           FIRM STATEMENT MESSAGE"
var headerLine4 = "01010004300100000000000326THIS IS A TEST MESSAGE AND WILL NEED TO BE CHANGED.  THIS    SCREEN ALLOWS YOU TO CREATE AN ALTERNATE MESSAGE THAT WILL  WILL APPEAR ON STATEMENTS."
var header = headerLine1 + "\n" + headerLine2 + "\n" + headerLine3 + "\n" + headerLine4 + "\n"

var footerLine1 = "998000043001999999999003720430012016040120160430000000002000000001000000000000000595000000000000000000000000000000000000000000634000001853000000055000000238000000000000000330000000004000000000000034914000000000000000000000000000000000000000000187000000000000000000000000000000000000000000000000000000000000000000000000000000000000039409000000000000000000000000000000000000"
var footerLine2 = "998000043001999999999003720430012016040120160430000000002000000004000000000000000595000000000000000000000000000000000000000000634000001853000000055000000238000000000000000330000000004000000000000034914000000000000000000000000000000000000000000187000000000000000000000000000000000000000000000000000000000000000000000000000000000000039409000000000000000000000000000000000000"
var footer = footerLine1 + "\n" + footerLine2 + "\n"

func createEntry(accountNumber string) (string) {
	var entryLine1 = fmt.Sprintf("0500000430010%s00568KIM SCHMIDT                   MMF TEST ACCOUNT 1            350 N SUNNYSLOPE RD           BROOKFIELD  WI  53005                                                                     5300500000000WI    0000000000000000000000000000000000000000110000000000                                                              111-22-333320160331 X0  4C  00000000 ASCHMIDT  K00000000USD                                                          LL   000000000000000000DLL01009999568F0000000  00000      SCHMIDT  KIM        Y     00000000O00000000O00000000", accountNumber)
	var entryLine2 = fmt.Sprintf("0700000430010%s00368LL01                                                                                                                                                                                                                              0000000000                                                                                                      LL", accountNumber)
	var entryLine3 = fmt.Sprintf("2000000430010%s003411 000000000000000000D00000000000000000000000000250000C000000000000250000C000000000000000000000000000000000000D000000000000000000000000000000000000D000000000000000000D000000000000000000D000000000000000000D000000000000000000D000000000000000000000000000000000000000000000000000000000000000000000000 000000000000000000D", accountNumber)
	var entryLine4 = fmt.Sprintf("2050000430010%s00258CASH000000000000000000D000000000000250000C000000000000000000D000000000000250000C000000000000000000D000000000000000000D000000000000000000D000000000000000000D000000000000000000D000000000000000000D000000000000000000D000000000000000000D", accountNumber)
	var entryLine5 = fmt.Sprintf("2050000430010%s00258TOTL000000000000000000D000000000000250000D000000000000000000D000000000000250000D000000000000000000D000000000000000000D000000000000000000D000000000000000000D000000000000000000D000000000000000000D000000000000000000D000000000000000000D", accountNumber)
	var entryLine6 = fmt.Sprintf("2300000430010%s00100     00000GROSS PROCEEDS          000000000000000000C000000000000291142C", accountNumber)
	return entryLine1 + "\n" + entryLine2 + "\n" + entryLine3 + "\n" + entryLine4 + "\n" + entryLine5 + "\n" + entryLine5 + "\n" + entryLine6
}

func randomAccountNumber() (string) {
	return fmt.Sprintf("%d%d%d%d%d%d%d%d",
		rand.Intn(9) + 1,
		rand.Intn(10),
		rand.Intn(10),
		rand.Intn(10),
		rand.Intn(10),
		rand.Intn(10),
		rand.Intn(10),
		rand.Intn(10))
}

func main() {
	count := 1
	if len(os.Args) == 2 {
		count, _ = strconv.Atoi(os.Args[1])
	}

	config := &ssh.ClientConfig{
		User: "loyal3",
		Auth: []ssh.AuthMethod{
			ssh.Password("password"),
		},
	}

	conn, err := ssh.Dial("tcp", "192.168.99.100:2222", config)
	check(err)
	sftp, err := sftp.NewClient(conn)
	check(err)
	defer sftp.Close()

	file, err := sftp.OpenFile("/beta/statement/stmt_mnth", os.O_RDWR)
	check(err)

	writer := bufio.NewWriter(file)
	writer.WriteString(header)
	println(fmt.Sprintf("creating %d entries", count))
	for i := 0; i < count; i++ {
		accountNumber := randomAccountNumber()
		writer.WriteString(createEntry(accountNumber))
	}
	writer.WriteString(footer)
	writer.Flush()
	println("finish writing file to sftp /beta/statement/stmt_mnth")
}